Testing Snowflake connection...
Initiating login request with your identity provider. A browser window should have opened for you to complete the login. If you can't see it, check existing browser windows, or your OS settings. Press CTRL+C to abort and try again...
Going to open: https://mqzfhld-vp00034.snowflakecomputing.com/console/login?login_name=james.moon%40sagebase.org&browser_mode_redirect_port=55387&proof_key=5kRjViT9HpjYNaF%2BGP4phYtbM3L5%2BpISXl7y9jDPsg4%3D to authenticate...
✓ Connected to Snowflake


============================================================
Testing: get_user_id_from_username
============================================================
Query SQL (first 200 chars):

    SELECT
        id AS user_id,
        user_name,
        email
    FROM
        synapse_data_warehouse.synapse.userprofile_latest
    WHERE
        LOWER(user_name) = LOWER('james.moon')
        ...
✓ Query executed successfully in 0.30s
  Rows returned: 1
  Columns: USER_ID, USER_NAME, EMAIL
  Sample data:
   USER_ID   USER_NAME                    EMAIL
0  3514384  james.moon  james.moon@sagebase.org

============================================================
Testing: query_user_files_downloaded
============================================================
Query SQL (first 200 chars):

    SELECT
        COUNT(DISTINCT objectdownload_event.file_handle_id) AS file_count,
        SUM(filelatest.content_size) AS total_size_bytes,
        COUNT(DISTINCT objectdownload_event.project_id)...
✓ Query executed successfully in 0.33s
  Rows returned: 1
  Columns: FILE_COUNT, TOTAL_SIZE_BYTES, PROJECT_COUNT
  Sample data:
   FILE_COUNT  TOTAL_SIZE_BYTES  PROJECT_COUNT
0         436       63266837824             59

============================================================
Testing: query_user_top_projects
============================================================
Query SQL (first 200 chars):

    WITH project_access AS (
        SELECT
            objectdownload_event.project_id,
            COUNT(DISTINCT objectdownload_event.file_handle_id) AS file_count,
            SUM(filelatest.cont...
✓ Query executed successfully in 0.28s
  Rows returned: 5
  Columns: PROJECT_ID, PROJECT_NAME, FILE_COUNT, TOTAL_SIZE_BYTES, ACCESS_DAYS
  Sample data:
   PROJECT_ID                                                                     PROJECT_NAME  FILE_COUNT  TOTAL_SIZE_BYTES  ACCESS_DAYS
0  64156441.0  Phase 1.5 clinical trial of PRG-N-01 and data collection by MRI in NF2 patients          78       58494934193           23
1  69797771.0                                                        clinicalomicsdb_data_test          67         796720762            1
2         NaN                                                                             None          47          15022714           45

============================================================
Testing: query_user_all_projects
============================================================
Query SQL (first 200 chars):

    WITH project_access AS (
        SELECT DISTINCT
            objectdownload_event.project_id
        FROM
            synapse_data_warehouse.synapse_event.objectdownload_event objectdownload_even...
✓ Query executed successfully in 0.23s
  Rows returned: 62
  Columns: PROJECT_ID, PROJECT_NAME
  Sample data:
   PROJECT_ID                                                                                                               PROJECT_NAME
0  69797771.0                                                                                                  clinicalomicsdb_data_test
1  63944395.0  DLK1 Distinguishes Subsets of NF1-Associated Malignant Peripheral Nerve Sheath Tumors with Divergent Molecular Signatures
2  33715357.0                                                                                                             FAIR demo data

============================================================
Testing: query_user_active_days
============================================================
Query SQL (first 200 chars):

    SELECT
        COUNT(DISTINCT DATE(record_date)) AS active_days
    FROM
        synapse_data_warehouse.synapse_event.objectdownload_event
    WHERE
        user_id = 3514384
        AND record_d...
✓ Query executed successfully in 0.29s
  Rows returned: 1
  Columns: ACTIVE_DAYS
  Sample data:
   ACTIVE_DAYS
0          128

============================================================
Testing: query_user_activity_by_date
============================================================
Query SQL (first 200 chars):

    SELECT
        DATE(record_date) AS activity_date,
        COUNT(*) AS activity_count
    FROM
        synapse_data_warehouse.synapse_event.objectdownload_event
    WHERE
        user_id = 351438...
✓ Query executed successfully in 0.24s
  Rows returned: 128
  Columns: ACTIVITY_DATE, ACTIVITY_COUNT
  Sample data:
  ACTIVITY_DATE  ACTIVITY_COUNT
0    2025-01-02               9
1    2025-01-14               5
2    2025-01-21               1

============================================================
Testing: query_user_activity_by_month
============================================================
Query SQL (first 200 chars):

    SELECT
        DATE_TRUNC('month', record_date) AS month,
        COUNT(DISTINCT DATE(record_date)) AS active_days,
        COUNT(DISTINCT file_handle_id) AS files_downloaded,
        COUNT(DISTI...
✓ Query executed successfully in 0.26s
  Rows returned: 12
  Columns: MONTH, ACTIVE_DAYS, FILES_DOWNLOADED, PROJECTS_ACCESSED
  Sample data:
        MONTH  ACTIVE_DAYS  FILES_DOWNLOADED  PROJECTS_ACCESSED
0  2025-01-01            8                23                  6
1  2025-02-01            9                30                  8
2  2025-03-01            9                18                  4

============================================================
Testing: query_user_activity_by_hour
============================================================
Query SQL (first 200 chars):

    SELECT
        DATE_PART('hour', CONVERT_TIMEZONE('UTC', 'America/Chicago', timestamp)) AS hour_of_day,
        COUNT(*) AS download_count,
        COUNT(DISTINCT file_handle_id) AS unique_files
...
✓ Query executed successfully in 0.75s
  Rows returned: 24
  Columns: HOUR_OF_DAY, DOWNLOAD_COUNT, UNIQUE_FILES
  Sample data:
   HOUR_OF_DAY  DOWNLOAD_COUNT  UNIQUE_FILES
0            0               1             1
1            1               3             3
2            2               1             1

============================================================
Testing: query_user_collaboration_network
============================================================
Query SQL (first 200 chars):

    WITH target_user_files AS (
        SELECT DISTINCT
            objectdownload_event.file_handle_id
        FROM
            synapse_data_warehouse.synapse_event.objectdownload_event objectdownlo...
✓ Query executed successfully in 1.36s
  Rows returned: 16381
  Columns: USER_ID, SHARED_PROJECTS, SHARED_FILES, COLLABORATION_SCORE
  Sample data:
   USER_ID  SHARED_PROJECTS  SHARED_FILES  COLLABORATION_SCORE
0  3459953                0            72                   72
1  3461573                0            58                   58
2   273950                0            54                   54

============================================================
Testing: query_user_top_collaborators
============================================================
Query SQL (first 200 chars):

    WITH target_user_files AS (
        SELECT DISTINCT
            objectdownload_event.file_handle_id,
            objectdownload_event.project_id
        FROM
            synapse_data_warehouse.sy...
✓ Query executed successfully in 0.29s
  Rows returned: 5
  Columns: USER_ID, SHARED_PROJECTS, SHARED_FILES, COLLABORATION_SCORE, COLLABORATOR_NAME
  Sample data:
   USER_ID  SHARED_PROJECTS  SHARED_FILES  COLLABORATION_SCORE       COLLABORATOR_NAME
0  3459953               20            72                   72  christina.conrad.parry
1  3461573               10            58                   58            anthony.pena
2   273950                2            54                   54               anonymous

============================================================
Testing: query_user_creations
============================================================
Query SQL (first 200 chars):

    SELECT
        node_type,
        COUNT(*) AS creation_count
    FROM
        synapse_data_warehouse.synapse.node_latest
    WHERE
        created_by = 3514384
        AND created_on BETWEEN '202...
✓ Query executed successfully in 0.26s
  Rows returned: 5
  Columns: NODE_TYPE, CREATION_COUNT
  Sample data:
    NODE_TYPE  CREATION_COUNT
0      folder            1657
1  entityview               2
2     project               2

============================================================
Testing: query_user_first_download
============================================================
Query SQL (first 200 chars):

    SELECT
        od.record_date AS first_download_date,
        COALESCE(nl.name, CONCAT('syn', od.file_handle_id)) AS file_name,
        COALESCE(
            JSON_EXTRACT_PATH_TEXT(pn.ANNOTATIONS...
✓ Query executed successfully in 0.26s
  Rows returned: 1
  Columns: FIRST_DOWNLOAD_DATE, FILE_NAME, PROJECT_NAME
  Sample data:
  FIRST_DOWNLOAD_DATE     FILE_NAME              PROJECT_NAME
0          2025-01-02  syn151328598  NF Data Portal (backend)

============================================================
Testing: query_user_busiest_day
============================================================
Query SQL (first 200 chars):

    SELECT
        DATE(record_date) AS busiest_date,
        COUNT(*) AS download_count,
        COUNT(DISTINCT file_handle_id) AS unique_files,
        COUNT(DISTINCT project_id) AS projects_access...
✓ Query executed successfully in 0.24s
  Rows returned: 1
  Columns: BUSIEST_DATE, DOWNLOAD_COUNT, UNIQUE_FILES, PROJECTS_ACCESSED, TOTAL_SIZE_BYTES
  Sample data:
  BUSIEST_DATE  DOWNLOAD_COUNT  UNIQUE_FILES  PROJECTS_ACCESSED  TOTAL_SIZE_BYTES
0   2025-11-06              71            71                  4         798789962

============================================================
Testing: query_user_largest_download
============================================================
Query SQL (first 200 chars):

    SELECT DISTINCT
        od.file_handle_id,
        COALESCE(nl.name, CONCAT('syn', nl.id)) AS file_name,
        fl.content_size,
        od.record_date,
        COALESCE(
            JSON_EXTRAC...
✓ Query executed successfully in 0.33s
  Rows returned: 1
  Columns: FILE_HANDLE_ID, FILE_NAME, CONTENT_SIZE, RECORD_DATE, PROJECT_NAME
  Sample data:
   FILE_HANDLE_ID                 FILE_NAME  CONTENT_SIZE RECORD_DATE                                                                     PROJECT_NAME
0       164697597  01S15_Visit 2_251026.zip     777127214  2025-11-15  Phase 1.5 clinical trial of PRG-N-01 and data collection by MRI in NF2 patients

============================================================
Testing: query_user_average_file_size
============================================================
Query SQL (first 200 chars):

    SELECT
        AVG(fl.content_size) AS avg_file_size,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY fl.content_size) AS median_file_size
    FROM
        synapse_data_warehouse.synapse_even...
✓ Query executed successfully in 0.57s
  Rows returned: 1
  Columns: AVG_FILE_SIZE, MEDIAN_FILE_SIZE
  Sample data:
   AVG_FILE_SIZE  MEDIAN_FILE_SIZE
0   9.763401e+07          153590.0

============================================================
Testing: query_platform_average_file_size
============================================================
Query SQL (first 200 chars):

    SELECT
        AVG(fl.content_size) AS avg_file_size,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY fl.content_size) AS median_file_size
    FROM
        synapse_data_warehouse.synapse_even...
✓ Query executed successfully in 0.35s
  Rows returned: 1
  Columns: AVG_FILE_SIZE, MEDIAN_FILE_SIZE
  Sample data:
   AVG_FILE_SIZE  MEDIAN_FILE_SIZE
0   1.949010e+08           44178.0


============================================================
VALIDATION SUMMARY
============================================================
Total queries tested: 16
Successful: 16
Failed: 0

✓ Full results saved to query_validation_results.json
